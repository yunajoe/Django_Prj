# users app을 따로 만들어서 회원가입, 로그인, 로그아웃 기능을 구현해보았다. 
# 원래는 diary(app)에다가 user 기능을 했으나 따로 회원관리 app을 만들면 더 편리?!( 이유는 다시 찾아봐야겠다)
(project의 default app하나, diary(app), uesrs(app) # 추가..~ ) 
# 회원가입과 로그인은 사용자가 입력하는것이기 때문에 form을 사용한다. 

urls.py
from django.urls import path
from .import views

urlpatterns = [
    path('login/', views.login, name='login'),
    path('signup/', views.signup, name='signup'), # users/singup 으로 간당
    path('logout/', views.logout, name='logout'),
]

--------------------------------------------------------
1.singup 

forms.py 

from django import forms
from django.contrib.auth.models import User

참고자료:
# https://docs.djangoproject.com/en/4.0/ref/contrib/auth/#fields
# https://django.cowhite.com/blog/django-forms-and-model-forms/

class SignUpForm(forms.ModelForm):
      name = forms.CharField(label="이름",max_length=100)
      username = forms.CharField(label='아이디 입력', min_length=5, max_length=150)
      password1 = forms.CharField(label='비밀번호 입력', widget=forms.PasswordInput)
      password2 = forms.CharField(label='비밀번호 확인', widget=forms.PasswordInput)
      email = forms.EmailField(label="이메일 입력")
      phone = forms.CharField(label="전화번호 입력",max_length=100)

      class Meta:
         model = User  # User 모델 불러옴
         fields = ['name', 'username', 'password1','password2', 'email', 'phone']
         
views.py 

def signup(request):
    if request.method == 'POST':
        form = SignUpForm(request.POST)
        if form.is_valid():  # 유효성 검사에서 통과가 되면은!
            new_user = User.objects.create_user(
                username = form.cleaned_data["username"],
                email = form.cleaned_data["email"],
                password = form.cleaned_data["password"]
            )
            new_user.save()
            return redirect('base')
    else:
        form = SignUpForm()
    return render(request, "users/signup.html", {'form': form})
    
singup.html

<html>

<head>
    <title>Sign up</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
</head>

<body>
    <div class="content container">
        <header class="page-header">
            <h1>회원가입</h1>
        </header>
        <div class="row">
            <div class="col-md-16">
                <form method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="name">이름</label>
                        <input type="text" name="name" class="form-control" id="name" placeholder="name">
                    </div>
                    <div class="form-group">
                        <label for="username">아이디</label>
                        <input type="text" name="username" class="form-control" id="username" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="password1">비밀번호</label>
                        <input type="text" name="password1" class="form-control" id="password1" placeholder="비밀번호">
                    </div>
                    <div class="form-group">
                        <label for="password2">비밀번호확인</label>
                        <input type="text" name="password2" class="form-control" id="password1" placeholder="Password">
                    </div>
                    <div class="form-group">
                        <label for="email">이메일</label>
                        <input type="text" name="email" class="form-control" id="email" placeholder="abc@gmail.com형식으로 입력해주세요">
                    </div>
                    <div class="form-group">
                        <label for="phone">전화번호</label>
                        <input type="text" name="phone" class="form-control" id="phone" placeholder="phone">
                    </div>
                    <button type="submit" class="btn btn-default">Submit</button>
                </form>
            </div>
        </div>
    </div>
</body>

</html>
------------------------------------------------------
2. login 

forms.py

class LoginForm(forms.ModelForm):
      username = forms.CharField(label='아이디 입력', min_length=5, max_length=150)
      password = forms.CharField(label='비밀번호 입력', widget=forms.PasswordInput)

      class Meta:
            model = User
            fields = ['username', 'password']


views.py 


def Login(request):
    if request.method == 'POST':
        form = Login(request.POST)
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(username = username, password = password)
        if user is not None:
            login(request, user)
            return redirect('base')
        else:
            return HttpResponse('Login failed. Try again.')
    else:
        form = LoginForm()
        return render(request, 'users/login.html')
        
        
        
login.html

<html>

<head>
    <title>Login</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
</head>

<body>
    <div class="content container">
        <header class="page-header">
            <h1>Login</h1>
        </header>
        <div class="row">
            <div class="col-md-16">
                <form method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" class="form-control" id="username" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="text" name="password" class="form-control" id="password" placeholder="Password">
                    </div>
                    <button type="submit" class="btn btn-default">Submit</button>
                </form>
            </div>
        </div>
    </div>
</body>

</html>
----------------------------------------------------------
3.logout
def logout(request):
        logout(request)
        return redirect('base')

